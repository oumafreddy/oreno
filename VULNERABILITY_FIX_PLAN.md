# Vulnerability Fix Plan - Based on pip-audit Results

## Summary
Found **27 vulnerabilities in 12 packages**. This document provides a prioritized, safe update plan.

## Priority Classification

### ðŸ”´ CRITICAL - Update Immediately (Security-Critical)

These affect core security and should be updated first:

1. **Django 5.1.8 â†’ 5.1.14** (7 CVEs)
   - PYSEC-2025-37, PYSEC-2025-47, GHSA-6w2r-r2m5-xq5w, GHSA-hpr9-3m2g-3j9p, GHSA-q95w-c7qg-hrff, GHSA-qw25-v68c-qjf3, GHSA-frmv-pr5f-9mcr
   - **Action**: Update to Django 5.1.14 (latest 5.1.x security release)

2. **djangorestframework 3.15.1 â†’ 3.15.2**
   - GHSA-gw84-84pc-xp82
   - **Action**: Update to 3.15.2

3. **djangorestframework-simplejwt 5.5.0 â†’ 5.5.1**
   - GHSA-5vcc-86wm-547q
   - **Action**: Update to 5.5.1

4. **requests 2.32.3 â†’ 2.32.4**
   - GHSA-9hjg-9r4m-mvj7
   - **Action**: Update to 2.32.4

5. **urllib3 2.3.0 â†’ 2.5.0**
   - GHSA-48p4-8xcf-vxj5, GHSA-pq67-6m6q-mj2v
   - **Action**: Update to 2.5.0

6. **protobuf 5.29.4 â†’ 5.29.5**
   - GHSA-8qvm-5x2c-j2w7
   - **Action**: Update to 5.29.5 (stay on 5.x line)

7. **setuptools 75.8.0 â†’ 78.1.1**
   - PYSEC-2025-49
   - **Action**: Update to 78.1.1

### ðŸŸ¡ HIGH PRIORITY - Update Soon (Important Security)

8. **brotli 1.1.0 â†’ 1.2.0**
   - GHSA-2qfp-q593-8484
   - **Action**: Update to 1.2.0

9. **pypdf 5.4.0 â†’ 6.1.3**
   - GHSA-7hfw-26vp-jp8m, GHSA-vr63-x8vc-m265, GHSA-jfx9-29x2-rv3j
   - **Note**: This is a major version jump (5.x â†’ 6.x), test thoroughly
   - **Action**: Update to 6.1.3

10. **pdfminer-six 20231228 â†’ 20251107**
    - GHSA-wf5f-4jwr-ppcp, GHSA-f83h-ghpp-7wcc
    - **Action**: Update to 20251107

### ðŸŸ¢ MEDIUM PRIORITY - Update When Convenient (ML/AI Related)

11. **keras 3.9.2 â†’ 3.12.0**
    - Multiple CVEs (GHSA-c9rc-mg46-23w3, GHSA-36fq-jgmw-4r9c, GHSA-36rr-ww3j-vrjv, GHSA-mq84-hjqx-cwf2, GHSA-28jp-44vh-q42h)
    - **Note**: Only update if you're actively using Keras/TensorFlow
    - **Action**: Update to 3.12.0 (or remove if not used)

12. **smolagents 1.12.0 â†’ 1.22.0**
    - GHSA-6v92-r5mx-h5fx, GHSA-8mf9-rmgw-33qc
    - **Note**: Only update if you're using this package
    - **Action**: Update to 1.22.0 (or remove if not used)

## Step-by-Step Update Plan

### Phase 1: Critical Security Updates (Do First)

```bash
# 1. Backup your current requirements
cp requirements.txt requirements.txt.backup

# 2. Update critical security packages
pip install --upgrade \
    Django==5.1.14 \
    djangorestframework==3.15.2 \
    djangorestframework-simplejwt==5.5.1 \
    requests==2.32.4 \
    urllib3==2.5.0 \
    protobuf==5.29.5 \
    setuptools==78.1.1

# 3. Update requirements.txt
pip freeze | grep -E "(Django|djangorestframework|djangorestframework-simplejwt|requests|urllib3|protobuf|setuptools)" >> requirements_updated.txt
# Manually merge these into requirements.txt
```

### Phase 2: High Priority Updates (After Testing Phase 1)

```bash
# Update high priority packages
pip install --upgrade \
    brotli==1.2.0 \
    pypdf==6.1.3 \
    pdfminer-six==20251107

# Test thoroughly - pypdf is a major version jump
```

### Phase 3: Medium Priority (Optional - Only if Used)

```bash
# Only if you're using these packages
pip install --upgrade \
    keras==3.12.0 \
    smolagents==1.22.0
```

## Testing Checklist After Each Phase

After updating, verify:

- [ ] Application starts: `python manage.py check`
- [ ] Database migrations: `python manage.py migrate --check`
- [ ] Run tests: `python manage.py test` (if you have tests)
- [ ] Test authentication/login
- [ ] Test API endpoints (DRF)
- [ ] Test JWT token generation/validation
- [ ] Test PDF generation (if using pypdf/pdfminer)
- [ ] Test file uploads/downloads
- [ ] Test multi-tenant functionality (django-tenants)
- [ ] Check admin panel works

## Automated Update Script

Create a script to update all critical packages at once:

```bash
# update_security.sh (or update_security.ps1 for PowerShell)
#!/bin/bash
# Backup
cp requirements.txt requirements.txt.backup

# Update critical packages
pip install --upgrade \
    Django==5.1.14 \
    djangorestframework==3.15.2 \
    djangorestframework-simplejwt==5.5.1 \
    requests==2.32.4 \
    urllib3==2.5.0 \
    protobuf==5.29.5 \
    setuptools==78.1.1 \
    brotli==1.2.0

# Update requirements.txt (manual step - review changes)
echo "Review the changes and update requirements.txt manually"
```

## Important Notes

### Django Update (5.1.8 â†’ 5.1.14)
- This is a **patch-level update** within the same minor version
- Should be backward-compatible
- Contains 7 security fixes
- **Test thoroughly** but should be safe

### pypdf Update (5.4.0 â†’ 6.1.3)
- This is a **major version jump** (5.x â†’ 6.x)
- May have breaking changes
- Check pypdf changelog: https://github.com/py-pdf/pypdf/blob/main/CHANGELOG.md
- **Test PDF operations thoroughly**

### urllib3 Update (2.3.0 â†’ 2.5.0)
- Minor version jump (2.3 â†’ 2.5)
- Should be backward-compatible
- Contains security fixes

## Rollback Plan

If something breaks:

```bash
# Restore from backup
cp requirements.txt.backup requirements.txt

# Reinstall old versions
pip install -r requirements.txt
```

## Next Steps

1. **Immediate**: Update Phase 1 packages (Critical Security)
2. **Today**: Test thoroughly after Phase 1
3. **This Week**: Update Phase 2 packages (High Priority)
4. **Optional**: Update Phase 3 packages if you use them

## Verification

After updating, run pip-audit again to verify fixes:

```bash
pip-audit -r requirements.txt
```

You should see fewer or no vulnerabilities in the updated packages.

