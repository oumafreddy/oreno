{% extends 'reports/base_report.html' %}
{% block content %}
<div class="container mt-3">
  <h2>Compliance Obligation Details</h2>
  <p><strong>Organization:</strong> {{ organization.name }}</p>
  {% if obligation %}
    <div class="card mb-3">
      <div class="card-body">
        <h4>{{ obligation.obligation_id }}</h4>
        <p><strong>Requirement:</strong> {{ obligation.requirement.title|truncatechars:40 }}</p>
        <p><strong>Owner:</strong> {% if obligation.owner %}{{ obligation.owner.email }}{% else %}{{ obligation.owner_email }}{% endif %}</p>
        <p><strong>Status:</strong> {{ obligation.status|title }}</p>
        <p><strong>Due Date:</strong> {{ obligation.due_date }}</p>
        <p><strong>Priority:</strong> {{ obligation.priority }}</p>
        <p><strong>Completion Date:</strong> {{ obligation.completion_date|default:'-' }}</p>
        <p><strong>Description:</strong> {{ obligation.description|striptags|truncatechars:200 }}</p>
        <p><strong>Evidence Required:</strong> {{ obligation.evidence_required|yesno:'Yes,No' }}</p>
        <p><strong>Active:</strong> {{ obligation.is_active|yesno:'Yes,No' }}</p>
      </div>
    </div>
    <h5>Related Evidence</h5>
    <table class="table table-striped table-sm">
      <thead class="table-light">
        <tr>
          <th>Document</th>
          <th>Validity Start</th>
          <th>Validity End</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for ev in evidences %}
        <tr>
          <td>{{ ev.document.title|truncatechars:40 }}</td>
          <td>{{ ev.validity_start }}</td>
          <td>{{ ev.validity_end }}</td>
          <td>{{ ev.notes|striptags|truncatechars:40 }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="4" class="text-center text-muted">No evidence found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="alert alert-warning">No obligation found for the given ID.</div>
  {% endif %}
</div>
{% endblock %} 