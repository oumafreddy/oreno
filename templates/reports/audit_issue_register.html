{% extends "reports/base_report.html" %}
{% block content %}
<style>
table.table-sm th, table.table-sm td {
  padding: 4px 6px;
  font-size: 12px;
  word-break: break-word;
}
</style>
<h2>Audit Issue Register</h2>
<form method="get" class="mb-2">
  <label for="engagement_name">Engagement Name:</label>
  <select name="engagement_name" id="engagement_name" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
    <option value="">All</option>
    {% for name in engagement_names %}
      <option value="{{ name }}" {% if filters.engagement_name == name %}selected{% endif %}>{{ name }}</option>
    {% endfor %}
  </select>
</form>
<p>Filters: Status: {{ filters.status|default:'All' }}, Severity: {{ filters.severity|default:'All' }}, Engagement: {{ filters.engagement_name|default:'All' }}</p>
<table class="table table-sm">
  <tr>
    <th>Code</th><th>Title</th><th>Status</th><th>Severity</th><th>Owner</th><th>Date Identified</th><th>Remediation Deadline</th>
  </tr>
  {% for issue in issues %}
    <tr>
      <td>{{ issue.code }}</td>
      <td>{{ issue.issue_title }}</td>
      <td>{{ issue.get_issue_status_display }}</td>
      <td>{{ issue.get_severity_status_display }}</td>
      <td>{{ issue.issue_owner.email|default:issue.issue_owner_email|default:'Unassigned' }}</td>
      <td>{{ issue.date_identified }}</td>
      <td>{{ issue.remediation_deadline_date|default:'-' }}</td>
    </tr>
  {% endfor %}
</table>
{% endblock %} 