{% extends 'reports/base_report.html' %}
{% load static %}

{% block content %}
<div class="report-container">
    <!-- Professional Header -->
    <div class="report-header">
        <div class="header-content">
            <h1 class="report-title">Legal Party Register Report</h1>
            <p class="report-subtitle">Comprehensive Overview of Legal Parties Management</p>
            <div class="header-meta">
                <span><strong>Organization:</strong> {{ organization.name }}</span>
                <span><strong>Generated:</strong> {{ generation_timestamp }}</span>
                {% if filters.party_type or filters.party_name %}
                <span><strong>Filters Applied:</strong> 
                    {% if filters.party_type %}Party Type: {{ filters.party_type }}{% endif %}
                    {% if filters.party_name %}{% if filters.party_type %} | {% endif %}Party Name: {{ filters.party_name }}{% endif %}
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Executive Summary -->
    <div class="section">
        <h2 class="section-header">Executive Summary</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-number">{{ total_parties|default:0 }}</div>
                <div class="stat-label">Total Parties</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ plaintiffs|default:0 }}</div>
                <div class="stat-label">Plaintiffs</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ defendants|default:0 }}</div>
                <div class="stat-label">Defendants</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ witnesses|default:0 }}</div>
                <div class="stat-label">Witnesses</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">{{ third_parties|default:0 }}</div>
                <div class="stat-label">Third Parties</div>
            </div>
        </div>
    </div>

    <!-- Party Type Distribution -->
    <div class="section">
        <h2 class="section-header">Party Type Distribution</h2>
        <div class="table-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Party Type</th>
                        <th>Count</th>
                        <th>Percentage</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in party_type_distribution %}
                    <tr>
                        <td>
                            <span class="party-type-badge party-{{ item.party_type }}">
                                {{ item.party_type|title }}
                            </span>
                        </td>
                        <td>{{ item.count }}</td>
                        <td>{% widthratio item.count total_parties 100 %}%</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="no-data">No party type data available</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Recent Parties -->
    <div class="section">
        <h2 class="section-header">Recent Parties</h2>
        <div class="table-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Party Name</th>
                        <th>Type</th>
                        <th>Contact Person</th>
                        <th>Contact Email</th>
                        <th>Contact Phone</th>
                        <th>Created Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for party in recent_parties %}
                    <tr>
                        <td>{{ party.name }}</td>
                        <td>
                            <span class="party-type-badge party-{{ party.party_type }}">
                                {{ party.party_type|title }}
                            </span>
                        </td>
                        <td>{{ party.contact_person|default:"-" }}</td>
                        <td>{{ party.contact_email|default:"-" }}</td>
                        <td>{{ party.contact_phone|default:"-" }}</td>
                        <td>{{ party.created_at|date:"M j, Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="no-data">No recent parties</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- All Parties -->
    <div class="section">
        <h2 class="section-header">All Parties</h2>
        <div class="table-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Party Name</th>
                        <th>Type</th>
                        <th>Contact Person</th>
                        <th>Contact Email</th>
                        <th>Contact Phone</th>
                        <th>Address</th>
                        <th>Created Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for party in parties %}
                    <tr>
                        <td>{{ party.name }}</td>
                        <td>
                            <span class="party-type-badge party-{{ party.party_type }}">
                                {{ party.party_type|title }}
                            </span>
                        </td>
                        <td>{{ party.contact_person|default:"-" }}</td>
                        <td>{{ party.contact_email|default:"-" }}</td>
                        <td>{{ party.contact_phone|default:"-" }}</td>
                        <td>{{ party.address|default:"-"|truncatechars:50 }}</td>
                        <td>{{ party.created_at|date:"M j, Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="no-data">No parties found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Key Insights -->
    <div class="section">
        <h2 class="section-header">Key Insights & Recommendations</h2>
        <div class="insights-container">
            <div class="insight-item">
                <h4>Party Distribution Analysis</h4>
                <p>
                    <strong>Total Parties:</strong> {{ total_parties }} parties involved in legal cases.
                    {% if plaintiffs > defendants %}
                    <strong>Case Type:</strong> More plaintiffs ({{ plaintiffs }}) than defendants ({{ defendants }}) 
                    suggests primarily defensive legal strategy.
                    {% elif defendants > plaintiffs %}
                    <strong>Case Type:</strong> More defendants ({{ defendants }}) than plaintiffs ({{ plaintiffs }}) 
                    suggests primarily offensive legal strategy.
                    {% else %}
                    <strong>Balance:</strong> Equal number of plaintiffs and defendants indicates balanced case portfolio.
                    {% endif %}
                </p>
            </div>
            
            <div class="insight-item">
                <h4>Witness Management</h4>
                <p>
                    {% if witnesses > 0 %}
                    <strong>Witness Pool:</strong> {{ witnesses }} witnesses available for case support. 
                    Ensure proper witness preparation and coordination.
                    {% else %}
                    <strong>Witness Strategy:</strong> No witnesses currently registered. Consider witness identification 
                    and preparation for case strengthening.
                    {% endif %}
                </p>
            </div>
            
            <div class="insight-item">
                <h4>Third Party Involvement</h4>
                <p>
                    {% if third_parties > 0 %}
                    <strong>Complex Cases:</strong> {{ third_parties }} third parties involved, indicating complex 
                    legal matters requiring careful coordination.
                    {% else %}
                    <strong>Case Complexity:</strong> No third parties currently involved, suggesting straightforward 
                    legal matters.
                    {% endif %}
                </p>
            </div>
            
            <div class="insight-item">
                <h4>Contact Information Management</h4>
                <p>
                    {% if total_parties > 0 %}
                    <strong>Data Quality:</strong> Contact information should be consistently maintained for all parties 
                    to ensure effective communication and case management.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="report-footer">
        <p><strong>Report Generated:</strong> {{ generation_timestamp }}</p>
        <p><strong>Organization:</strong> {{ organization.name }}</p>
        <p><strong>Total Parties Analyzed:</strong> {{ total_parties }}</p>
    </div>
</div>

<style>
    .party-type-badge {
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 8pt;
        font-weight: 600;
    }
    .party-plaintiff { background: #dbeafe; color: #1e40af; }
    .party-defendant { background: #fecaca; color: #7f1d1d; }
    .party-witness { background: #fef3c7; color: #92400e; }
    .party-third_party { background: #d1fae5; color: #065f46; }
</style>
{% endblock %}
