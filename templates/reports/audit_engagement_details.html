{% extends "reports/base_report.html" %}
{% load crispy_forms_tags %}
{% block content %}
<!-- PAGE 1: Logo and Title -->
<div style="text-align:center; margin-top: 80px;">
  <img src="{{ organization.logo.url }}" alt="{{ organization.name }} Logo" style="max-height:120px; max-width:300px; margin-bottom: 30px;" />
  <h1 style="margin-top: 30px; color: #2563eb;">Audit Engagement Details Report</h1>
</div>
<div style="page-break-after: always;"></div>
<!-- PAGE 2+: Engagement Details -->
{% if engagement %}
  <h2 class="section-title">Engagement Details</h2>
  <table class="table table-sm">
    <tr><th>Status</th><td>{{ engagement.get_project_status_display }}</td></tr>
    <tr><th>Type</th><td>{{ engagement.engagement_type }}</td></tr>
    <tr><th>Start Date</th><td>{{ engagement.project_start_date }}</td></tr>
    <tr><th>End Date</th><td>{{ engagement.target_end_date }}</td></tr>
    <tr><th>Engagement</th><td class="truncate">{{ engagement.title }}</td></tr>
    <tr><th>Code</th><td>{{ engagement.code }}</td></tr>
    <tr><th>Workplan</th><td class="truncate">{{ engagement.audit_workplan.name }} ({{ engagement.audit_workplan.fiscal_year }})</td></tr>
    <tr><th>Assigned To</th><td>{{ engagement.assigned_to.email }}</td></tr>
  </table>
  <span class="label">Executive Summary:</span>
  <div class="truncate">{{ engagement.executive_summary|striptags|truncatechars:300 }}</div>
  <span class="label">Purpose:</span>
  <div class="truncate">{{ engagement.purpose|striptags|truncatechars:300 }}</div>
  <span class="label">Background:</span>
  <div class="truncate">{{ engagement.background|striptags|truncatechars:300 }}</div>
  <span class="label">Scope:</span>
  <div class="truncate">{{ engagement.scope|striptags|truncatechars:300 }}</div>
  <span class="label">Objectives:</span>
  <div class="truncate">{{ engagement.project_objectives|striptags|truncatechars:300 }}</div>
  <span class="label">Conclusion:</span>
  <div>{{ engagement.get_conclusion_display }}</div>
  <span class="label">Conclusion Description:</span>
  <div class="truncate">{{ engagement.conclusion_description|striptags|truncatechars:300 }}</div>
  <h4 class="section-title">Issues</h4>
  <p>No issues linked to this engagement.</p>
{% else %}
  <div class="alert alert-warning">No engagement found for the selected name.</div>
{% endif %}
{% endblock %} 