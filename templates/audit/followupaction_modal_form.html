{% load crispy_forms_tags %}
<div class="modal-header bg-light">
  <h5 class="modal-title">
    <i class="bi bi-clipboard2-check me-2"></i>
    {% if form.instance.pk %}Edit{% else %}Add{% endif %} Follow-Up Action
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<div class="modal-body">
  <form id="followupactionForm" 
        method="post" 
        hx-post="{{ request.path }}" 
        hx-target="#followup-list-container" 
        hx-swap="outerHTML" 
        enctype="multipart/form-data" 
        novalidate
        data-mode="{% if form.instance.pk %}edit{% else %}add{% endif %}"
        hx-trigger="submit"
        hx-indicator="#form-indicator">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
      <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {% for error in form.non_field_errors %}
          {{ error }}
        {% endfor %}
      </div>
    {% endif %}
    
    {{ form|crispy }}
    
    <div class="d-flex justify-content-end mt-4">
      <button type="submit" id="submitButton" class="btn btn-primary">
        <span class="spinner-border spinner-border-sm me-1 d-none" role="status" aria-hidden="true"></span>
        <span class="btn-text">
          <i class="bi bi-save me-1"></i> {% if form.instance.pk %}Update{% else %}Save{% endif %}
        </span>
      </button>
      <button type="button" class="btn btn-secondary ms-2" data-bs-dismiss="modal" onclick="window.location.href='{% url 'audit:issue-detail' issue_pk %}'">Cancel</button>
    </div>
  </form>
</div>

<div id="form-indicator" class="htmx-indicator" style="display: none;">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>