{% load static %}

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Risks</h5>
    {% if objective %}
      <a href="{% url 'audit:risk-add' objective_id=objective.pk %}" class="btn btn-success btn-sm">
        <i class="bi bi-plus-circle me-1"></i>Add Risk
      </a>
    {% endif %}
  </div>
  <div class="card-body">
    {% if risks %}
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>Title</th>
              <th>Category</th>
              <th>Risk Level</th>
              <th>Impact</th>
              <th>Likelihood</th>
              <th>Objective</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for risk in risks %}
              <tr>
                <td>
                  <a href="{% url 'audit:risk-detail' risk.pk %}" class="text-decoration-none">
                    {{ risk.title }}
                  </a>
                </td>
                <td>
                  <span class="badge bg-secondary">{{ risk.get_category_display|default:"Not specified" }}</span>
                </td>
                <td>
                  <span class="badge bg-{% if risk.risk_level == 'high' %}danger{% elif risk.risk_level == 'medium' %}warning{% else %}info{% endif %}">
                    {{ risk.get_risk_level_display }}
                  </span>
                </td>
                <td>
                  {% if risk.impact %}
                    {{ risk.get_impact_display }} ({{ risk.impact }})
                  {% else %}
                    <span class="text-muted">Not specified</span>
                  {% endif %}
                </td>
                <td>
                  {% if risk.likelihood %}
                    {{ risk.get_likelihood_display }} ({{ risk.likelihood }})
                  {% else %}
                    <span class="text-muted">Not specified</span>
                  {% endif %}
                </td>
                <td>
                  {% if risk.objective %}
                    <a href="{% url 'audit:objective-detail' risk.objective.pk %}" class="text-decoration-none">
                      {{ risk.objective.title }}
                    </a>
                  {% else %}
                    <span class="text-muted">Not assigned</span>
                  {% endif %}
                </td>
                <td>
                  <div class="btn-group btn-group-sm" role="group">
                    <a href="{% url 'audit:risk-detail' risk.pk %}" class="btn btn-outline-primary">
                      <i class="bi bi-eye"></i> View
                    </a>
                    <a href="{% url 'audit:risk-edit' risk.pk %}" class="btn btn-outline-secondary">
                      <i class="bi bi-pencil"></i> Edit
                    </a>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-center py-4">
        <i class="bi bi-shield-exclamation text-muted" style="font-size: 2rem;"></i>
        <p class="text-muted mt-2">No risks found for this engagement.</p>
        <p class="text-muted small">Risks are created through the audit workflow: Engagement → Objective → Risk</p>
      </div>
    {% endif %}
  </div>
</div>
