{% load static %}
{% load crispy_forms_tags %}
<div class="modal-header">
  <h5 class="modal-title">{% if form.instance.pk %}Edit{% else %}Add{% endif %} Retest</h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
  {% if issue and issue.pk %}
    <form id="issueretestForm" method="post"
          hx-post="{% if form.instance.pk %}{% url 'audit:issueretest-modal-edit' issue_pk=issue.pk pk=form.instance.pk %}{% else %}{% url 'audit:issueretest-modal-add' issue_pk=issue.pk %}{% endif %}"
          hx-target="#globalModal .modal-content"
          hx-swap="innerHTML"
          enctype="multipart/form-data">
      {% csrf_token %}
      {{ form|crispy }}
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" id="submitBtn" class="btn btn-primary">
          <span id="retest-upload-spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
          <span id="submitText">Save</span>
        </button>
      </div>
    </form>
  {% else %}
    <div class="alert alert-danger">
      Cannot add retest: Issue not found or not saved. Please save the issue first.
    </div>
  {% endif %}
</div>
<script src="{% static 'js/issueretest_modal_form.js' %}" nonce="{{ request.csp_nonce }}"></script> 