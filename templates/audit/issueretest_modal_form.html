{% load static %}
{% load crispy_forms_tags %}
{{ form.media }}
<div class="modal-header">
  <h5 class="modal-title">{% if form.instance.pk %}Edit{% else %}Add{% endif %} Retest</h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body">
  {% if issue and issue.pk %}
    <form id="issueretestForm" method="post"
          hx-post="{% if form.instance.pk %}{% url 'audit:issueretest-modal-edit' issue_pk=issue.pk pk=form.instance.pk %}{% else %}{% url 'audit:issueretest-modal-add' issue_pk=issue.pk %}{% endif %}"
          hx-target="#modal-body"
          hx-swap="outerHTML"
          enctype="multipart/form-data">
      {% csrf_token %}
      {{ form.issue|as_crispy_field }}
      {{ form.retest_date|as_crispy_field }}
      {{ form.retested_by|as_crispy_field }}
      {{ form.result|as_crispy_field }}
      {% include 'audit/_ckeditor_field.html' with field=form.notes %}
      {{ form.created_at|as_crispy_field }}
      <div class="d-flex justify-content-end mt-4">
        <button type="submit" class="btn btn-success">Save</button>
        <button type="button" class="btn btn-secondary ms-2" data-bs-dismiss="modal">Cancel</button>
      </div>
    </form>
  {% else %}
    <div class="alert alert-danger">
      Cannot add retest: Issue not found or not saved. Please save the issue first.
    </div>
  {% endif %}
</div> 