{% extends 'base.html' %}
{% load crispy_forms_tags static %}
{% block title %}Risks{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row mb-3">
    <div class="col d-flex justify-content-between align-items-center">
      <h2 class="mb-0"><i class="bi bi-exclamation-triangle me-2"></i>Risks</h2>
      <a href="{% url 'risk:risk_create' %}" class="btn btn-primary"><i class="bi bi-plus"></i> Add Risk</a>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <form id="risk-filter-form" class="row g-2 mb-3">
    <div class="col-md-2">
      <input type="text" class="form-control" name="owner" placeholder="Owner">
    </div>
    <div class="col-md-2">
      <select class="form-select" name="category">
        <option value="">All Categories</option>
        <option value="operational">Operational</option>
        <option value="strategic">Strategic</option>
        <option value="financial">Financial</option>
        <option value="compliance">Compliance</option>
        <option value="other">Other</option>
      </select>
    </div>
    <div class="col-md-2">
      <select class="form-select" name="status">
        <option value="">All Statuses</option>
        <option value="open">Open</option>
        <option value="closed">Closed</option>
        <option value="in-progress">In Progress</option>
      </select>
    </div>
    <div class="col-md-2 d-flex align-items-center">
      <button type="submit" class="btn btn-outline-primary me-2">Filter</button>
      <button type="button" id="reset-filters" class="btn btn-outline-secondary">Reset</button>
    </div>
  </form>

  <div class="mb-3">
    <a id="export-csv" href="#" class="btn btn-outline-secondary me-2">Export CSV</a>
    <a id="export-excel" href="#" class="btn btn-outline-success">Export Excel</a>
  </div>

  <div class="card">
    <div class="card-body p-0">
      <div id="risk-loading" class="text-center py-4" style="display:none;">
        <div class="spinner-border text-primary" role="status"></div>
        <div>Loading risks...</div>
      </div>
      <div id="risk-error" class="alert alert-danger m-3" style="display:none;"></div>
      <table class="table table-hover align-middle mb-0" id="risk-table">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Owner</th>
            <th>Category</th>
            <th>Status</th>
            <th>Score</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- AJAX results here -->
        </tbody>
      </table>
    </div>
  </div>
  <nav class="mt-3">
    <ul class="pagination" id="risk-pagination"></ul>
  </nav>
</div>

<!-- Removed inline <script> for risk list logic. Now loaded from static/js/risk_list.js with nonce. -->
<script src="{% static 'js/risk_list.js' %}" nonce="{{ request.csp_nonce }}"></script>
{% endblock %} 