{% extends 'base.html' %}
{% block title %}Control Detail{% endblock %}
{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-3">
        <div class="col">
            <h2>Control: {{ control.name }}</h2>
            <a href="{% url 'risk:control_update' control.pk %}" class="btn btn-secondary"><i class="bi bi-pencil"></i> Edit</a>
            <a href="{% url 'risk:control_delete' control.pk %}" class="btn btn-danger"><i class="bi bi-trash"></i> Delete</a>
            <a href="{% url 'risk:control_list' %}" class="btn btn-outline-primary float-end"><i class="bi bi-arrow-left"></i> Back to List</a>
        </div>
    </div>
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card mb-3">
                <div class="card-header bg-light"><strong>Control Details</strong></div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Code</dt><dd class="col-sm-8">{{ control.code }}</dd>
                        <dt class="col-sm-4">Type</dt><dd class="col-sm-8">{{ control.get_control_type_display }}</dd>
                        <dt class="col-sm-4">Nature</dt><dd class="col-sm-8">{{ control.get_control_nature_display }}</dd>
                        <dt class="col-sm-4">Frequency</dt><dd class="col-sm-8">{{ control.get_control_frequency_display }}</dd>
                        <dt class="col-sm-4">Status</dt><dd class="col-sm-8">{{ control.get_status_display }}</dd>
                        <dt class="col-sm-4">Effectiveness</dt><dd class="col-sm-8">{{ control.get_effectiveness_rating_display }}</dd>
                        <dt class="col-sm-4">Owner</dt><dd class="col-sm-8">{{ control.control_owner }}</dd>
                        <dt class="col-sm-4">Owner Department</dt><dd class="col-sm-8">{{ control.owner_department }}</dd>
                        <dt class="col-sm-4">Last Review Date</dt><dd class="col-sm-8">{{ control.last_review_date }}</dd>
                        <dt class="col-sm-4">Next Review Date</dt><dd class="col-sm-8">{{ control.next_review_date }}</dd>
                        <dt class="col-sm-4">Documentation</dt><dd class="col-sm-8">{% if control.documentation %}<a href="{{ control.documentation.url }}">Download</a>{% else %}<span class="text-muted">None</span>{% endif %}</dd>
                        <dt class="col-sm-4">Description</dt><dd class="col-sm-8">{{ control.description|safe }}</dd>
                    </dl>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header bg-light"><strong>Related Risks</strong></div>
                <div class="card-body">
                    {% if control.risks.all %}
                        <ul class="list-group list-group-flush">
                        {% for risk in control.risks.all %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <a href="{% url 'risk:risk_detail' risk.pk %}">{{ risk.risk_name }}</a>
                                <span class="badge bg-info">{{ risk.get_category_display }}</span>
                            </li>
                        {% empty %}
                            <li class="list-group-item text-muted">No risks linked.</li>
                        {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 